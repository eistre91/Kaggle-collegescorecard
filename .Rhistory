?kmeans
setwd("C:/Kaggle-collegescorecard/")
library(ggplot2)
library(dplyr)
library(RSQLite)
library(gridExtra)
my_db <- src_sqlite("database.sqlite")
tbl <- tbl(my_db, "Scorecard")
data_dictionary <- read.csv("CollegeScorecardDataDictionary-09-12-2015.csv")
earnings <- select(tbl, contains("_p10"), -CUML_DEBT_P10)
completion_rates <- select(tbl, C150_4_POOLED, C150_L4_POOLED, C200_4_POOLED, C200_L4_POOLED,
C150_4_POOLED_SUPP, C150_L4_POOLED_SUPP, C200_4_POOLED_SUPP, C200_L4_POOLED_SUPP)
retention_rates <- select(tbl, RET_FT4:RET_PTL4)
first_full_time <- select(tbl, PFTFTUG1_EF)
part_time <- select(tbl, PPTUG_EF)
enrollment <- select(tbl, UGDS)
adult_students <- select(tbl, UG25abv)
degree_breakdown <- select(tbl, PCIP01:PCIP54)
carnegie_classes <- select(tbl, CCBASIC:CCSIZSET)
cost <- select(tbl, NPT4_PUB, NPT4_PRIV, COSTT4_A:TUITIONFEE_PROG)
school_business <- select(tbl, TUITFTE:PFTFAC)
descriptive_information <- select(tbl, UNITID:LONGITUDE, Year)
admission_rate <- select(tbl, ADM_RATE)
test_scores <- select(tbl, SATVR25:SAT_AVG)
federal_aid_percent <- select(tbl, PCTFLOAN, PCTPELL)
debt_medians <- select(tbl, GRAD_DEBT_MDN, GRAD_DEBT_MDN_SUPP, WDRAW_DEBT_MDN)
operating <- select(tbl, CURROPER)
online <- select(tbl, DISTANCEONLY)
trim <- select(tbl, contains("_p10"), -CUML_DEBT_P10, C150_4_POOLED, C150_L4_POOLED, C200_4_POOLED, C200_L4_POOLED, C150_4_POOLED_SUPP, C150_L4_POOLED_SUPP, C200_4_POOLED_SUPP, C200_L4_POOLED_SUPP, RET_FT4:RET_PTL4, PFTFTUG1_EF, PPTUG_EF, UGDS, UG25abv, PCIP01:PCIP54, CCBASIC:CCSIZSET, NPT4_PUB, NPT4_PRIV, COSTT4_A:TUITIONFEE_PROG, TUITFTE:PFTFAC, UNITID:LONGITUDE, Year, ADM_RATE, SATVR25:SAT_AVG, PCTFLOAN, PCTPELL, GRAD_DEBT_MDN, GRAD_DEBT_MDN_SUPP, WDRAW_DEBT_MDN, CURROPER, DISTANCEONLY)
trim <- collect(trim)
current_colnames <- colnames(trim)
for(i in 1:length(current_colnames)) {
location <- which(data_dictionary$VARIABLE.NAME == current_colnames[i])
if(length(location) == 0) {next}
new_name <- as.character(data_dictionary[location, 4])
if(new_name != "") {current_colnames[i] <- new_name}
}
current_colnames <- make.names(current_colnames, unique = TRUE)
colnames(trim) <- current_colnames
trim <- trim %>% filter(state %in% c("AL", "AK", "AZ", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "AR", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"))
carnegie <- trim %>% filter(Year == 2013) %>% select(name, carnegie_basic)
for(id in 1:nrow(carnegie)) {
trim$carnegie_basic[trim$name %in% carnegie$name[id]] <- carnegie$carnegie_basic[id]
}
cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
ten <- trim %>% filter(Year %in% c(2007, 2009, 2011))
ten_earnings <- ten %>% filter(!is.na(X10_yrs_after_entry.median), X10_yrs_after_entry.median > 0)
KMC
program_clusters <- kmeans(degree_breakdown_filter, centers=9, iter.max=1000)
degree_breakdown <- collect(degree_breakdown)
degree_breakdown_filter <- trim %>% select(contains("program_percentage")) %>% filter(!is.na(program_percentage.agriculture))
program_clusters <- kmeans(degree_breakdown_filter, centers=9, iter.max=1000)
program_clusters
ten_earnings
program_clusters$cluster
ten_earnings$program_cluster <- program_clusters$cluster
degree_breakdown_filter <- ten_earnings %>% select(contains("program_percentage")) %>% filter(!is.na(program_percentage.agriculture))
degree_breakdown_filter
ten_earnings
ten_earnings_filter <- filter(ten_earnings, !is.na(program_percentage.agriculture))
ten_earnings_filter
ten_earnings_filter$program_cluster <- program_clusters$cluster
ten_earnings_filter
degree_breakdown_filter <- ten_earnings %>% select(contains("program_percentage")) %>% filter(!is.na(program_percentage.agriculture))
program_clusters <- kmeans(degree_breakdown_filter, centers=9, iter.max=1000)
program_clusters
ten_earnings_filter <- filter(ten_earnings, !is.na(program_percentage.agriculture))
ten_earnings_filter$program_cluster <- program_clusters$cluster
ten_earnings_filter
ten_earnings_filter$program_cluster
ggplot(aes(x = program_cluster), data = ten_earnings_filter) +
geom_boxplot(aes(y = median_earnings, fill=cbPalette[2])) +
scale_x_discrete(limits=unique(ten_earnings_filter$program_cluster)) +
scale_y_continuous(limits=c(0, 100000)) +
guides(fill=FALSE)
ten_earnings_filter
ggplot(aes(x = program_cluster), data = ten_earnings_filter) +
geom_boxplot(aes(y = X10_yrs_after_entry.median, fill=cbPalette[2])) +
scale_y_continuous(limits=c(0, 100000)) +
scale_x_discrete(limits=unique(ten_earnings_filter$program_cluster)) +
guides(fill=FALSE)
ten_earnings_filter$program_cluster <- as.factor(ten_earnings_filter$program_cluster)
ggplot(aes(x = program_cluster), data = ten_earnings_filter) +
geom_boxplot(aes(y = X10_yrs_after_entry.median, fill=cbPalette[2])) +
scale_y_continuous(limits=c(0, 100000)) +
scale_x_discrete(limits=unique(ten_earnings_filter$program_cluster)) +
guides(fill=FALSE)
program_clusters
program_clusters$centers
program_clusters$centers[6]
program_clusters$centers[6,]
program_clusters$centers[1,]
program_clusters$centers[6,]
program_clusters$centers[7,]
filter(ten_earnings_filter, program_cluster==7)
filter(ten_earnings_filter, program_cluster==7)$name
filter(ten_earnings_filter, program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, program_cluster==7)$name
filter(ten_earnings_filter, !contains("beauty"))
filter(ten_earnings_filter, !contain("beauty"))
?filter
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name))
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name), program_cluster==7)
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name), program_cluster==7)$name
?grepl
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special"), ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, name),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, carnegie_basic),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, carnegie_basic),
!is.na(carnegie_basic),
program_cluster==7)$name
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, carnegie_basic),
!is.na(carnegie_basic),
program_cluster==7)$carnegie_basic
filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, carnegie_basic),
!is.na(carnegie_basic),
program_cluster==7)$name
ten_earnings_filter <- filter(ten_earnings_filter, !grepl("beauty", ignore.case = TRUE, name),
!grepl("hair", ignore.case = TRUE, name),
!grepl("cosmetology", ignore.case = TRUE, name),
!grepl("culinary", ignore.case = TRUE, name),
!grepl("funeral", ignore.case = TRUE, name),
!grepl("restaurant", ignore.case = TRUE, name),
!grepl("mortuary", ignore.case = TRUE, name),
!grepl("special", ignore.case = TRUE, carnegie_basic),
!is.na(carnegie_basic))
ten_earnings_filter
degree_breakdown_filter <- ten_earnings_filter %>% select(contains("program_percentage")) %>% filter(!is.na(program_percentage.agriculture))
degree_breakdown_filter
ten_earnings_filter
degree_breakdown_filter <- ten_earnings_filter %>% select(contains("program_percentage"))
SumWithinss = sapply(2:10,
function(x)
sum(kmeans(degree_breakdown_filter, centers=x, iter.max=1000)$withinss))
plot(2:10, SumWithinss, type="b")
program_clusters <- kmeans(degree_breakdown_filter, centers=7, iter.max=1000)
program_clusters
ten_earnings_filter$program_cluster <- program_clusters$cluster
ten_earnings_filter$program_cluster <- as.factor(ten_earnings_filter$program_cluster)
filter(ten_earnings_filter, program_cluster==1)$name
filter(ten_earnings_filter, program_cluster==1)$carnegie_basic
ggplot(aes(x = program_cluster), data = ten_earnings_filter) +
geom_boxplot(aes(y = X10_yrs_after_entry.median, fill=cbPalette[2])) +
scale_y_continuous(limits=c(0, 100000)) +
scale_x_discrete(limits=unique(ten_earnings_filter$program_cluster)) +
guides(fill=FALSE)
program_clusters$centers[3,]
program_clusters$centers[3,] > .1
program_clusters$centers[5,] > ,1
program_clusters$centers[5,] > .1
program_clusters$centers[5,]
program_clusters$centers[7,]
program_clusters$centers[7,] > .1
program_clusters$centers[7,]
program_clusters$centers[6,]
program_clusters$centers[2,]
program_clusters$centers[2,] > .1
program_clusters$centers[1,] > .1
program_clusters$centers[1,]
program_clusters$centers[4,]
filter(ten_earnings_filter, program_cluster==1)$carnegie_basic
filter(ten_earnings_filter, program_cluster==1)$name
filter(ten_earnings_filter, program_cluster==3)$name
ten_earnings_filter <- filter(ten_earnings_filter,
!grepl("the art institute", ignore.case = TRUE, name),
!grepl("media", ignore.case = TRUE, name),
!is.na(carnegie_basic))
filter(ten_earnings_filter, program_cluster==3)$name
degree_breakdown_filter <- ten_earnings_filter %>% select(contains("program_percentage"))
SumWithinss = sapply(2:10,
function(x)
sum(kmeans(degree_breakdown_filter, centers=x, iter.max=1000)$withinss))
plot(2:10, SumWithinss, type="b")
program_clusters <- kmeans(degree_breakdown_filter, centers=7, iter.max=1000)
ten_earnings_filter$program_cluster <- program_clusters$cluster
ten_earnings_filter$program_cluster <- as.factor(ten_earnings_filter$program_cluster)
filter(ten_earnings_filter, program_cluster==1)$carnegie_basic
ggplot(aes(x = program_cluster), data = ten_earnings_filter) +
geom_boxplot(aes(y = X10_yrs_after_entry.median, fill=cbPalette[2])) +
scale_y_continuous(limits=c(0, 100000)) +
scale_x_discrete(limits=unique(ten_earnings_filter$program_cluster)) +
guides(fill=FALSE)
ten_earnings_filter
filter(ten_earnings_filter, program_cluster==1)$carnegie_basic
filter(ten_earnings_filter, program_cluster==1)$name
program_clusters$centers[1,]
filter(ten_earnings_filter, program_cluster==1)$name
filter(ten_earnings_filter, program_cluster==1)$carnegie_basic
grepl("associate's", ignore.case=TRUE, filter(ten_earnings_filter, program_cluster==1)$carnegie_basic)
sum(grepl("associate's", ignore.case=TRUE, filter(ten_earnings_filter, program_cluster==1)$carnegie_basic))/length(filter(ten_earnings_filter, program_cluster==1)$carnegie_basic))
sum(grepl("associate's", ignore.case=TRUE, filter(ten_earnings_filter, program_cluster==1)$carnegie_basic))/length(filter(ten_earnings_filter, program_cluster==1)$carnegie_basic)
